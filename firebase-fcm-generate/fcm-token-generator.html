<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCM Token Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        #token {
            word-break: break-all;
            padding: 10px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            margin: 10px 0;
        }
        button {
            padding: 8px 16px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #3367d6;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Firebase Cloud Messaging Token Generator</h1>
    <p>Click the button below to generate and display your FCM token:</p>
    <button id="generate">Generate Token</button>
    <button id="resetToken">Reset Token</button>
    <button id="copy" style="display:none;">Copy Token</button>
    
    <h2>Your FCM Token:</h2>
    <div id="token">No token generated yet.</div>
    
    <h2>Status:</h2>
    <div id="status">Ready</div>
    
    <!-- Load Firebase libraries first -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-messaging-compat.js"></script>
    
    <script>
        // Wait for the page to fully load
        window.onload = function() {
            const generateBtn = document.getElementById('generate');
            const resetTokenBtn = document.getElementById('resetToken');
            const copyBtn = document.getElementById('copy');
            const tokenDiv = document.getElementById('token');
            const statusDiv = document.getElementById('status');
            
            // Your Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyBTsZhODnVYMBQZ3LHFL6iHs7WG0cwbFN4",
                authDomain: "test-5fd83.firebaseapp.com",
                projectId: "test-5fd83",
                storageBucket: "test-5fd83.firebasestorage.app",
                messagingSenderId: "1023392310465",
                appId: "1:1023392310465:web:d7db1d89f61c507c78e040",
                measurementId: "G-HW4098PWTW"
            };
            
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            
            // Check if service worker is supported
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/firebase-messaging-sw.js')
                .then(function(registration) {
                    statusDiv.textContent = "Service Worker registered successfully";
                    console.log('Service Worker registered successfully:', registration.scope);
                    
                    // Now that service worker is registered, add click events
                    generateBtn.addEventListener('click', generateToken);
                    resetTokenBtn.addEventListener('click', resetAndGenerateToken);
                    copyBtn.addEventListener('click', copyToken);
                })
                .catch(function(error) {
                    statusDiv.innerHTML = "<span class='error'>Service Worker registration failed: " + error.message + "</span>";
                    console.error('Service Worker registration failed:', error);
                });
            } else {
                statusDiv.innerHTML = "<span class='error'>Service Workers are not supported in this browser</span>";
                console.error('Service Workers are not supported in this browser');
            }
            
            async function generateToken() {
                try {
                    statusDiv.textContent = "Requesting permission...";
                    
                    const messaging = firebase.messaging();
                    
                    // Request permission
                    const permission = await Notification.requestPermission();
                    if (permission !== 'granted') {
                        statusDiv.innerHTML = "<span class='error'>Notification permission denied</span>";
                        return;
                    }
                    
                    statusDiv.textContent = "Getting token...";
                    
                    // Get token
                    const token = await messaging.getToken({
                        vapidKey: 'BDEdvc7F_szVwJYyn619-m9x0zC76yeSyYiMZnFyF49aj6_cBy_P8dsseqVbK5SUvEoemlqX-RrMI8sFeMUMjuo'
                    });

                    console.log('FCM Token:', token);
                    
                    tokenDiv.textContent = token;
                    copyBtn.style.display = 'inline-block';
                    statusDiv.textContent = "Token generated successfully!";
                } catch (error) {
                    console.error('Error getting token:', error);
                    statusDiv.innerHTML = "<span class='error'>Error: " + error.message + "</span>";
                }
            }
            
            async function resetAndGenerateToken() {
                try {
                    statusDiv.textContent = "Deleting existing token...";
                    
                    const messaging = firebase.messaging();
                    
                    // Delete the existing token first
                    await messaging.deleteToken();
                    console.log('Token deleted successfully');
                    tokenDiv.textContent = "Previous token deleted";
                    
                    // Then generate a new token
                    await generateToken();
                } catch (error) {
                    console.error('Error resetting token:', error);
                    statusDiv.innerHTML = "<span class='error'>Error resetting token: " + error.message + "</span>";
                }
            }
            
            function copyToken() {
                const tokenText = tokenDiv.textContent;
                navigator.clipboard.writeText(tokenText)
                    .then(() => {
                        statusDiv.textContent = "Token copied to clipboard!";
                    })
                    .catch(err => {
                        statusDiv.innerHTML = "<span class='error'>Failed to copy: " + err.message + "</span>";
                    });
            }
        };
    </script>
</body>
</html>